CREATE OR REPLACE PROCEDURE DUOC.SETXUATID ()
P1: BEGIN
	DECLARE M_XUATID CHAR(15);
	FOR r AS SELECT * FROM DUOC.CHITIETXUAT DO
		SELECT MAX(XUATID) INTO M_XUATID FROM DUOC.CHITIETXUAT WHERE LEFT(MAPX,10) = r.MAPX; 
		IF M_XUATID IS NULL OR M_XUATID = '' THEN
	 	   	SET M_XUATID = r.MAPX || '00001';
	 	ELSE
	 		SET M_XUATID = LTRIM(CAST(M_XUATID AS BIGINT) + 1);
	 	END IF;
	 	UPDATE DUOC.CHITIETXUAT SET XUATID = M_XUATID WHERE MAPX = r.MAPX AND MASPSD = r.MASPSD;
	END FOR;	 
	
END P1