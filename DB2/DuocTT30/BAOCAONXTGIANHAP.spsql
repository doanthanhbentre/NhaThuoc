CREATE PROCEDURE DUOC.BAOCAONXTGIANHAP 
(
IN NAMTHANG CHAR(6),
IN MAKHO CHAR(2)  
)
DYNAMIC RESULT SETS 1
------------------------------------------------------------------------
-- SQL Stored Procedure 
------------------------------------------------------------------------
P1: BEGIN
	-- Declare cursor
	DECLARE cursor1 CURSOR WITH RETURN FOR
		SELECT TK.MASPSD, SP.TENSP, SP.TENDONVI, SP.NHOMSPID, SP.TENNHOMSP, DUOC.GETGIANHAP(SD.MASPSD) AS DONGIA,
		SLDK, 
		DUOC.GETGIANHAP(SD.MASPSD) * SLDK AS STDK, 
		SLNHAP, 
		DUOC.GETGIANHAP(SD.MASPSD) * SLNHAP AS STNHAP, 
		SLXUAT, 
		DUOC.GETGIANHAP(SD.MASPSD) * SLXUAT AS STXUAT, 
		SLTRANCC, 
		DUOC.GETGIANHAP(SD.MASPSD) * SLTRANCC AS STTRANCC, 
		SLTHANHLY,
		DUOC.GETGIANHAP(SD.MASPSD) * SLTHANHLY AS STTHANHLY,
		SLCK,
		DUOC.GETGIANHAP(SD.MASPSD) * SLCK AS STCK
		FROM 
		(SELECT MASPSD, 
			DUOC.TONDK(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLDK,
			DUOC.NHAPTK(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLNHAP,
			DUOC.XUATTK(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLXUAT,
			DUOC.TRANCC(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLTRANCC,
			DUOC.THANHLY(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLTHANHLY,
			DUOC.TONCK(TON.NAMTHANG, TON.MAKHO, TON.MASPSD) AS SLCK
		FROM DUOC.SANPHAMTON TON
		WHERE NAMTHANG = BAOCAONXTGIANHAP.NAMTHANG AND MAKHO = BAOCAONXTGIANHAP.MAKHO) TK 
			JOIN DUOC.SANPHAMSD SD ON TK.MASPSD = SD.MASPSD
			JOIN DUOC.VIEWSANPHAM SP ON SD.MASP = SP.MASP
		ORDER BY SP.NHOMSPID, TK.MASPSD; 

	-- Cursor left open for client application
	OPEN cursor1;
END P1